<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		å°è¯•å¼€å‘ä¸€ä¸ªç®€å•çš„Podç®¡ç†æ§åˆ¶å™¨ | 
	 
	å€ªå…‹æ¾çš„åšå®¢
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.google.com/search?q=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>


	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@v1.5.1/dist/Valine.min.js"></script>

	
	

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">å€ªå…‹æ¾çš„åšå®¢</a>

	<ul id="menu">
    

    

    

    
      
      
        <li class="menu-item">
          <a href='https://github.com/NikeSong' class="menu-item-link" target="_blank">
            Nicolson
          </a>
        </li>
      
    
  
    
      <li class="menu-item">
        <a href='https://github.com/NikeSong' class="menu-item-link" target="_blank">
          <i class="fa fa-github fa-2x"></i>
        </a>
      </li>
    
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="æŒ‰å›è½¦å…¨ç«™æœç´¢">
		<div id="tree">
			

			
							<ul>
								<li class="file">
									<a href="/2023/05/10/1.%20Kubernetes%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.md/">
                     
										    KubernetesåŸºæœ¬ç»“æ„
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/28/10.%20%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Client-go%E5%AE%9E%E7%8E%B0%E6%9C%BA%E7%90%86/">
                     
										    Client-Go åŸç†å­¦ä¹ 
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/27/11.%20Operator%E5%BC%80%E5%8F%91%E8%BF%9B%E9%98%B6/">
                     
										    Operatorå¼€å‘è¿›é˜¶ï¼ˆabortï¼‰
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/05/01/12.%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAOperator%E8%BE%93%E5%87%BA%E6%89%80%E6%9C%89Pod%E8%AF%A6%E6%83%85/">
                     
										    Operatorè¯»å–æ‰€æœ‰çš„Podï¼ŒDeployment,Service
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/05/10/13.%20Flink%E5%AD%A6%E4%B9%A0/">
                     
										    Flink
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/05/10/14.%20%E4%BF%AE%E6%94%B9api-server%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF/">
                     
										    é…ç½®Kubernetes API Serverçš„è¿æ¥å‚æ•°
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/23/2.%20Pod%E7%BB%86%E8%8A%82%E5%88%86%E6%9E%90/">
                     
										    Podç»†èŠ‚åˆ†æ
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/24/3.%20K8s%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/">
                     
										    K8sæœåŠ¡æš´éœ²
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/24/4.%20%E6%8E%A2%E7%A7%98Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">
                     
										    æ¢ç§˜Dockerå®¹å™¨çš„å®ç°åŸç†ï¼ˆè¿›è¡Œä¸­ï¼‰
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/25/5.%20%E4%BB%80%E4%B9%88%E6%98%AFOperator/">
                     
										    ä»€ä¹ˆæ˜¯Operator
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2023/04/25/6.%20%E5%B0%9D%E8%AF%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84Pod%E7%AE%A1%E7%90%86%E6%8E%A7%E5%88%B6%E5%99%A8/">
                     
										    å°è¯•å¼€å‘ä¸€ä¸ªç®€å•çš„Podç®¡ç†æ§åˆ¶å™¨
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/26/7.%20%E3%80%90%E6%95%85%E9%9A%9C%E3%80%91K8s%E7%BB%84%E4%BB%B6%E7%89%88%E6%9C%AC%E5%87%BA%E9%97%AE%E9%A2%98/">
                     
										    ã€æ•…éšœã€‘K8sç»„ä»¶ç‰ˆæœ¬å‡ºé—®é¢˜
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/27/7.5.%20%E3%80%90%E6%95%85%E9%9A%9C%E3%80%91%E4%B8%80%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%99%BB%E9%99%86%E4%B8%8D%E8%BF%9B%E5%8E%BB%E4%BA%86/">
                     
										    ã€æ•…éšœã€‘ä¸€å°è™šæ‹Ÿæœºç™»é™†ä¸è¿›å»äº†
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/27/8.%20k8s%20api%E5%AD%A6%E4%B9%A0/">
                     
										    curlæ–¹å¼å’Œrawæ–¹å¼è®¿é—®api server
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2023/04/28/9.%20GVK-%E7%BB%84%E3%80%81%E7%89%88%E6%9C%AC%E5%92%8C%E7%B1%BB%E5%9E%8B/">
                     
										    GVKå’ŒGVR
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
		</div>
	</div>
</div>

	<!-- å¼•å…¥æ­£æ–‡ -->
	<div id="content">
		<h1 id="article-title">
	å°è¯•å¼€å‘ä¸€ä¸ªç®€å•çš„Podç®¡ç†æ§åˆ¶å™¨
</h1>

<!-- meta -->
<div class="article-meta">
	

	<span>å€ªå…‹æ¾</span>
	<span>2023-04-25 14:58:00</span>

  <div id="article-categories">
    
		  <span>Categoriesï¼š</span>
      
          
              <span>
                  <i class="fa fa-folder" aria-hidden="true">
                  <a href="/categories/Kuberneteså­¦ä¹ ç¬”è®°/">Kuberneteså­¦ä¹ ç¬”è®°</a>
                  </i>
                
              </span>
          
      
    

    
		    <span>Tagsï¼š</span>
        
    
  </div>

</div>

<!-- content -->
<div id="article-content">
	<h2 id="å¼€å‘ä¸€ä¸ªPodç®¡ç†æ§åˆ¶å™¨">å¼€å‘ä¸€ä¸ªPodç®¡ç†æ§åˆ¶å™¨</h2>
<h3 id="1-å¼€å‘ç›®æ ‡">1. å¼€å‘ç›®æ ‡</h3>
<p>ç±»æ¯”äºDeploymentå¯ä»¥ç®¡ç†Podï¼Œæˆ‘ä»¬ç°åœ¨å°è¯•å¼€å‘ä¸€ä¸ªç®€å•çš„Podç®¡ç†æ§åˆ¶å™¨Application Operatorï¼Œä½†æ˜¯æš‚æ—¶åªæ”¯æŒPodå‰¯æœ¬æ•°çš„ç®¡ç†ã€‚</p>
<p>æˆ‘ä»¬è¦é€šè¿‡ä¸€ä¸ªApplicationç±»å‹æ¥å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„èµ„æºå¯¹è±¡ï¼Œç„¶ååœ¨æ§åˆ¶å™¨ä¸­è·å–è¿™ä¸ªèµ„æºå¯¹è±¡çš„è¯¦ç»†é…ç½®ï¼Œæ¥ç€æ ¹æ®å®ƒçš„é…ç½®å»åˆ›å»ºç›¸åº”æ•°é‡çš„Podï¼Œå°±åƒDe-ploymenté‚£æ ·å·¥ä½œã€‚å½“ç„¶ï¼Œä¸ºäº†é¿å…Demoé¡¹ç›®è¿‡äºå¤æ‚ï¼Œè¿™é‡Œä¸å»è€ƒè™‘è¿‡å¤šçš„å¼‚å¸¸å¤„ç†ã€ç¨‹åºå¥å£®æ€§ã€ä¸šåŠ¡é€»è¾‘å®Œå¤‡ç­‰ã€‚</p>
<p><img src="/images/application_operator_function.png" alt="that's the way"></p>
<h3 id="2-åˆå§‹åŒ–é¡¹ç›®">2. åˆå§‹åŒ–é¡¹ç›®</h3>
<p>åˆ›å»ºæ–‡ä»¶å¤¹ç»„ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢æ‰§è¡Œä»¥ä¸‹è¯­å¥</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubebuilder init <span class="token parameter variable">--domain</span><span class="token operator">=</span>danielhu.cn <span class="token parameter variable">--repo</span><span class="token operator">=</span>github.com/daniel-hutao/application-operator <span class="token parameter variable">--owner</span> Daniel.Hu<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‚æ•°å«ä¹‰</p>
<ul>
<li><code>â€“-domain lailin.xyz</code> æˆ‘ä»¬çš„é¡¹ç›®çš„åŸŸå</li>
<li><code>--repo xxx</code> æ˜¯ä»“åº“åœ°å€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ <code>go mode</code> ä¸­çš„ <code>repo</code> åœ°å€</li>
</ul>
<p><strong>æŠ¥é”™1ï¼š</strong></p>
<blockquote>
<p>å¦‚æœä½  <code>golang</code> ç‰ˆæœ¬è¿‡ä½æˆ–è€…è¿‡é«˜éƒ½æœ‰å¯èƒ½å‡ºç°ä¸‹æ–¹çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘è¿™é‡Œæ˜¯å› ä¸ºä½¿ç”¨çš„ <code>1.16</code> ç‰ˆæœ¬å¤ªé«˜äº†</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2021</span>/04/25 <span class="token number">20</span>:47:14 failed to initialize project: unable to run pre-scaffold tasks of <span class="token string">"base.go.kubebuilder.io/v3"</span><span class="token builtin class-name">:</span> go version <span class="token string">'go1.16'</span> is incompatible because <span class="token string">'requires 1.13 &lt;= version &lt; 1.16'</span><span class="token builtin class-name">.</span> You can skip this check using the --skip-go-version-check flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™ç§æƒ…å†µä¸‹å¯ä»¥æ·»åŠ  <code>--skip-go-version-check</code> å¿½ç•¥è¿™ä¸ªé”™è¯¯</p>
</blockquote>
<p><strong>æŠ¥é”™2ï¼š</strong></p>
<blockquote>
<p>æ‰¾ä¸åˆ°go</p>
<p>export PATH=$PATH:/usr/local/go/bin</p>
<p>ä¸Šè¿°æ–¹æ³•çš„PATH åœ¨ç»ˆç«¯å…³é—­ åå°±ä¼šæ¶ˆå¤±ã€‚æ‰€ä»¥è¿˜æ˜¯å»ºè®®é€šè¿‡ç¼–è¾‘/etc/profileæ¥æ”¹PATHï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å®¶ç›®å½•ä¸‹çš„.bashrc(å³ï¼š~/.bashrc)ã€‚</p>
<p>ä¿®æ”¹ç¯å¢ƒå˜é‡</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æœ€ä¸‹é¢åŠ ä¸Šï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/usr/local/xxx/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆ·æ–°ç¯å¢ƒå˜é‡</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<p><strong>æŠ¥é”™3ï¼š</strong></p>
<blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Error: failed to initialize project: unable to scaffold with <span class="token string">"base.go.kubebuilder.io/ve"</span><span class="token builtin class-name">:</span> <span class="token builtin class-name">exit</span> status l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Goçš„ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œæˆ‘ç”¨çš„æ˜¯1.17.6ï¼Œæ”¹ä¸º1.10.4ï¼Œçœ‹åˆ°åˆ«äººç”¨1.18.5æ”¹ä¸º1.18.5</p>
<p>ä»ç„¶æŠ¥é”™ï¼Œç ”ç©¶ä¸€ä¸‹åˆ + ä¸€æ™šä¸Šçœ‹äº†å„ç§æ–‡æ¡£å’Œissueä»ç„¶è§£å†³ä¸äº†ï¼Œå¿ƒå¦‚æ­»ç°æ¬²å“­æ— æ³ªï¼Œæ­£å‡†å¤‡æ˜å¤©æŠŠè™šæ‹Ÿæœºä»å¤´åˆ°å°¾éƒ½æ¢æˆå’Œæ•™ç¨‹åŒæ ·çš„ç‰ˆæœ¬æ—¶è·Ÿå®¤å‹æŠ±æ€¨èµ·è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä»–å¾ˆæ„Ÿå…´è¶£ï¼Œè¶´æˆ‘ç”µè„‘æ—è¾¹çœ‹é—®é¢˜ï¼Œæˆ‘å½“æ—¶å›å®¿èˆç”¨çš„æ˜¯è‡ªå·±ç¬”è®°æœ¬è¿œç¨‹ç™»é™†å®éªŒå®¤ç”µè„‘ï¼Œå®éªŒå®¤ç”µè„‘å¼€è™šæ‹Ÿæœº+vpnï¼Œä¸€æ‰“å¼€vpnæ•´ä¸ªç”»é¢å¡æˆPPTï¼Œä½†æ˜¯å°±åœ¨è¿™æ ·çš„æç«¯æ¶åŠ£çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆæ¢è°·æ­Œæœç´¢çœ‹äº†å‡ ä¸ªæ–‡ç« ï¼Œä»æœªè§£å†³ã€‚</p>
<p>åæ¥ä»–è¯´ä½ æŠŠè¿™ä¸ªæŠ¥é”™ä¿¡æ¯å‘ç»™æˆ‘æˆ‘å†çœ‹çœ‹ï¼Œä»–æ”¶åˆ°åç¬¬ä¸€æ—¶é—´æ‰“å¼€äº†ChatGPTğŸ˜‚GPTè¯´å¯èƒ½æ˜¯GOBINç¯å¢ƒæ²¡é…å¥½ï¼Œæˆ‘åˆæ£€æŸ¥äº†ç¯å¢ƒï¼Œè¯´å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œæˆ‘å¯»æ€ç½‘ç»œèƒ½æœ‰å•¥é—®é¢˜ï¼Œæˆ‘pingé›†ç¾¤pingç™¾åº¦éƒ½æ²¡é—®é¢˜ã€‚ã€‚ã€‚ã€‚</p>
<p>ã€‚ã€‚ã€‚ã€‚</p>
<p>ã€‚ã€‚ã€‚ã€‚</p>
<p>å§æ§½ï¼Œæˆ‘ä¹‹å‰åˆå§‹åŒ–é¡¹ç›®çš„æ—¶å€™æ˜¯ä¸æ˜¯éƒ½æ²¡å¼€VPNï¼Ÿ</p>
<p>æˆ‘è¯•ç€æ‰“å¼€VPNï¼Œé‡æ–°æ•²å…¥é‚£å¥ä»Šå¤©å·²ç»æ•²äº†100éçš„å‘½ä»¤<code>kubebuilder init XXXX</code>,å®ƒç«Ÿç„¶å¼€å§‹æ˜¾ç¤ºåœ¨githubä¸Šä¸‹è½½goçš„ä»€ä¹ˆä»€ä¹ˆä¸œè¥¿ï¼Œä¸€é•¿ä¸²å æ»¡äº†å±å¹•ã€‚ã€‚ã€‚æ­¤æ—¶æˆ‘å·²å‘†ä½ã€‚</p>
<p>é—®é¢˜è§£å†³ã€‚</p>
<p>(ä¹‹å‰ä¸€ç›´è§‰å¾—chatGPTè¢«å¹å¾—è¿‡å¤´äº†ï¼Œäº§ç”Ÿäº†å¾ˆåæ„Ÿçš„æƒ…ç»ªï¼Œè§‰å¾—ä¹Ÿå°±æ˜¯å¤–è¡Œäººæ‰æŠŠå®ƒè§†ä½œç¥æ˜ï¼Œå¹ä¸Šäº†å¤©ã€‚ç°åœ¨æ„Ÿè§‰è¿™ç©æ„è¿˜æ˜¯èƒ½æä¾›ä¸€äº›æ€è·¯çš„)</p>
</blockquote>
<p><strong>é¡¹ç›®æ–‡ä»¶ç»“æ„åˆ†æ</strong></p>
<p>åˆå§‹åŒ–å®Œä¹‹åæˆ‘çš„é¡¹ç›®ç»“æ„</p>
<p>.<br>
â”œâ”€â”€ config<br>
â”‚   â”œâ”€â”€ default<br>
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml<br>
â”‚   â”‚   â”œâ”€â”€ manager_auth_proxy_patch.yaml<br>
â”‚   â”‚   â””â”€â”€ manager_config_patch.yaml<br>
â”‚   â”œâ”€â”€ manager<br>
â”‚   â”‚   â”œâ”€â”€ controller_manager_config.yaml<br>
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml<br>
â”‚   â”‚   â””â”€â”€ manager.yaml<br>
â”‚   â”œâ”€â”€ prometheus<br>
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml<br>
â”‚   â”‚   â””â”€â”€ monitor.yaml<br>
â”‚   â””â”€â”€ rbac<br>
â”‚       â”œâ”€â”€ auth_proxy_client_clusterrole.yaml<br>
â”‚       â”œâ”€â”€ auth_proxy_role_binding.yaml<br>
â”‚       â”œâ”€â”€ auth_proxy_role.yaml<br>
â”‚       â”œâ”€â”€ auth_proxy_service.yaml<br>
â”‚       â”œâ”€â”€ kustomization.yaml<br>
â”‚       â”œâ”€â”€ leader_election_role_binding.yaml<br>
â”‚       â”œâ”€â”€ leader_election_role.yaml<br>
â”‚       â”œâ”€â”€ role_binding.yaml<br>
â”‚       â””â”€â”€ service_account.yaml<br>
â”œâ”€â”€ Dockerfile<br>
â”œâ”€â”€ go.mod<br>
â”œâ”€â”€ go.sum<br>
â”œâ”€â”€ hack<br>
â”‚   â””â”€â”€ boilerplate.go.txt<br>
â”œâ”€â”€ main.go<br>
â”œâ”€â”€ Makefile<br>
â”œâ”€â”€ PROJECT<br>
â””â”€â”€ <a target="_blank" rel="noopener" href="http://README.md">README.md</a></p>
<p>å¤§è‡´çœ‹ä¸€ä¸‹å…¶ä¸­çš„å‡ ä¸ªæ–‡ä»¶</p>
<ul>
<li>PROJECTï¼šè®°å½•å…ƒæ•°æ®</li>
<li>main.goï¼šé‡è¦çš„æ–‡ä»¶ï¼Œæ­¤å¤„å…ˆä¸åšåˆ†æã€‚æ³¨æ„åˆ°æ–‡ä»¶å¤´æœ‰copyrightä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯æ¥è‡ªhack/boilerplate.go.txtæ–‡ä»¶ã€‚</li>
<li>configï¼šè¿™ä¸ªç›®å½•ä¸­æ”¾ç½®äº†å¾ˆå¤šä¸ªYAMLæ–‡ä»¶ã€‚å…¶ä¸­åŒ…æ‹¬RBACæƒé™ç›¸å…³çš„YAMLæ–‡ä»¶ã€Prometheusç›‘æ§æœåŠ¡å‘ç°ï¼ˆServiceMonitorï¼‰ç›¸å…³çš„YAMLæ–‡ä»¶ã€æ§åˆ¶å™¨ï¼ˆManagerï¼‰æœ¬èº«éƒ¨ç½²çš„YAMLæ–‡ä»¶ç­‰ã€‚</li>
<li>Dockerfileï¼šæœ€ç»ˆOperatorç¨‹åºç¼–è¯‘ã€æ„å»ºé•œåƒçš„é€»è¾‘å°±åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥è§£å†³ä¸€äº›é•œåƒæ„å»ºç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚Goè¯­è¨€ä¾èµ–ä¸‹è½½çš„é»˜è®¤GOPROXYé…ç½®åœ¨å›½å†…ä¸ä¸€å®šèƒ½è®¿é—®åˆ°ï¼Œå¯ä»¥åœ¨å…¶ä¸­é…ç½®å›½å†…çš„proxyåœ°å€ç­‰ã€‚</li>
<li>Makefileï¼šè¿™æ˜¯è§£æ”¾åŠ³åŠ¨åŠ›çš„å·¥å…·ï¼Œè¿™é‡Œå®ç°äº†é€šè¿‡make Ã—Ã—Ã—è½»æ¾å®ç°æ•´ä¸ªç¨‹åºçš„ç¼–è¯‘æ„å»ºã€é•œåƒæ¨é€ã€éƒ¨ç½²ã€å¸è½½ç­‰æ“ä½œï¼Œåé¢ä¼šç»å¸¸ç”¨åˆ°ã€‚</li>
</ul>
<h3 id="3-æ·»åŠ API">3. æ·»åŠ API</h3>
<p>åœ¨application-operatorç›®å½•ä¸‹ç»§ç»­æ‰§è¡Œå‘½ä»¤ï¼Œè¿ç»­è¾“å…¥ä¸¤æ¬¡yï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubebuilder create api <span class="token parameter variable">--group</span> apps <span class="token parameter variable">--version</span> v1 <span class="token parameter variable">--kind</span> Application<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># kubebuilder create api --group apps --version v1 --kind Application</span>
Create Resource <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>
y
Create Controller <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>
y
Writing kustomize manifests <span class="token keyword">for</span> you to edit<span class="token punctuation">..</span>.
Writing scaffold <span class="token keyword">for</span> you to edit<span class="token punctuation">..</span>.
api/v1/application_types.go
controllers/application_controller.go
Update dependencies:
$ go mod tidy
go: downloading github.com/onsi/ginkgo/v2 v2.0.0
Running make:
$ <span class="token function">make</span> generate
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ–°å¢äº†å¾ˆå¤šæ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œå°¤å…¶æ˜¯apiæ–‡ä»¶å¤¹æ¯”è¾ƒé‡è¦ï¼›éƒ¨åˆ†æ–‡ä»¶æœ‰æ”¹åŠ¨ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡git statusè§‚å¯Ÿåˆ°ã€‚</p>
<h3 id="4-CRDå®ç°å’Œéƒ¨ç½²">4. CRDå®ç°å’Œéƒ¨ç½²</h3>
<p>æˆ‘ä»¬å‰é¢æåˆ°è¿‡CRDçš„ä»£ç ä¸»è¦å®šä¹‰åœ¨<strong>api/v1/application_types.go</strong>æ–‡ä»¶ä¸­ï¼Œå…ˆæ‰“å¼€çœ‹ä¸€ä¸‹ç°æœ‰ä»£ç æ˜¯æ€æ ·çš„ã€‚ä¸»è¦çœ‹Specç»“æ„ï¼Œä¹Ÿå°±æ˜¯ApplicationSpecè¿™ä¸ªç»“æ„ä½“çš„å®šä¹‰ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">type</span> ApplicationSpec struct <span class="token punctuation">&#123;</span>
	Foo string <span class="token variable"><span class="token variable">`</span>json:<span class="token string">"foo,omitempty"</span><span class="token variable">`</span></span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¢åŠ å†…å®¹å¦‚ä¸‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">import</span> <span class="token punctuation">(</span>
	corev1 <span class="token string">"k8s.io/api/core/v1"</span>
	metav1 <span class="token string">"k8s.io/apimachinery/pkg/apis/meta/v1"</span>
<span class="token punctuation">)</span>

// EDIT THIS FILE<span class="token operator">!</span>  THIS IS SCAFFOLDING FOR YOU TO OWN<span class="token operator">!</span>
// NOTE: json tags are required.  Any new fields you <span class="token function">add</span> must have json tags <span class="token keyword">for</span> the fields to be serialized.

// ApplicationSpec defines the desired state of Application
<span class="token builtin class-name">type</span> ApplicationSpec struct <span class="token punctuation">&#123;</span>
	Replicas int32                  <span class="token variable"><span class="token variable">`</span>json:<span class="token string">"replicas,omitempty"</span><span class="token variable">`</span></span>
	Template corev1.PodTemplateSpec <span class="token variable"><span class="token variable">`</span>json:<span class="token string">"template,omitempty"</span><span class="token variable">`</span></span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç„¶åä¿å­˜è°ƒç”¨å‘½ä»¤<code> make manifests</code>ï¼Œæ˜¾ç¤ºå¦‚ä¸‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/root/MyOPeratorProjects/application-operator/bin/controller-gen rbac:roleName<span class="token operator">=</span>manager-role crd webhook <span class="token assign-left variable">paths</span><span class="token operator">=</span><span class="token string">"./..."</span> output:crd:artifacts:config<span class="token operator">=</span>config/crd/bases<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–‡ä»¶/ç›®å½•ï¼š</p>
<ol>
<li><strong>Â·config/crd/bases/ï¼š<strong>è¿™ä¸ªç›®å½•ä¸­æ–°å¢äº†ä¸€ä¸ª</strong>apps.danielhu.cn_applications.yaml</strong>æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯Applicationç±»å‹çš„CRDé…ç½®ï¼š</li>
</ol>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apiextensions.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CustomResourceDefinition
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">controller-gen.kubebuilder.io/version</span><span class="token punctuation">:</span> v0.9.2
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> applications.apps.danielhu.cn
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">group</span><span class="token punctuation">:</span> apps.danielhu.cn
  <span class="token key atrule">names</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> Application
    <span class="token key atrule">listKind</span><span class="token punctuation">:</span> ApplicationList
    <span class="token key atrule">plural</span><span class="token punctuation">:</span> applications
    <span class="token key atrule">singular</span><span class="token punctuation">:</span> application
  <span class="token key atrule">scope</span><span class="token punctuation">:</span> Namespaced
  <span class="token key atrule">versions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> v1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li><strong>Â·config/rbac/role.yaml</strong>ï¼šè¿™é‡Œé¢å®šä¹‰çš„æ˜¯ä¸€ä¸ªClusterRoleï¼Œä»åå­—manager-roleä¸Šå¤§è‡´å¯ä»¥çŒœåˆ°ï¼Œè¿™æ˜¯åé¢Controlleréƒ¨ç½²åå°†å……å½“çš„â€œè§’è‰²â€ã€‚è¯¥æ–‡ä»¶å®šä¹‰äº†å¯¹applicationsèµ„æºçš„åˆ›å»ºã€åˆ é™¤ã€æŸ¥è¯¢ã€æ›´æ–°ç­‰æ“ä½œã€‚</li>
</ol>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> manager<span class="token punctuation">-</span>role
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> apps.danielhu.cn
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> applications
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> delete
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> patch
  <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> watch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> apps.danielhu.cn
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> applications/finalizers
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> update
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> apps.danielhu.cn
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> applications/status
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> patch
  <span class="token punctuation">-</span> update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡<code>make install</code>å‘½ä»¤æ¥å®ŒæˆCRDçš„éƒ¨ç½²è¿‡ç¨‹ï¼š</p>
<p><strong>æŠ¥é”™</strong></p>
<blockquote>
<p>The connection to the server 192.168.62.128:6443 was refused - did you specify the right host or port?<br>
make: *** [install] é”™è¯¯ 1</p>
<p>æ­¤æ—¶çªç„¶å‘ç°K8sé›†ç¾¤ä¸ç®¡ç”¨äº†ï¼ˆä¸ªäººç‰¹å¼‚æ€§åŸå› ï¼‰ï¼è§£å†³é—®é¢˜çš„è¿‡ç¨‹è§â€é›†ç¾¤å‡ºé—®é¢˜â€œæ–‡ç« ã€‚</p>
</blockquote>
<p>æˆåŠŸåè¾“å‡ºä»¥ä¸‹å†…å®¹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># make install</span>
<span class="token builtin class-name">test</span> <span class="token parameter variable">-s</span> /root/MyOPeratorProjects/application-operator/bin/controller-gen <span class="token operator">||</span> <span class="token assign-left variable">GOBIN</span><span class="token operator">=</span>/root/MyOPeratorProjects/application-operator/bin go <span class="token function">install</span> sigs.k8s.io/controller-tools/cmd/controller-gen@v0.9.2
/root/MyOPeratorProjects/application-operator/bin/controller-gen rbac:roleName<span class="token operator">=</span>manager-role crd webhook <span class="token assign-left variable">paths</span><span class="token operator">=</span><span class="token string">"./..."</span> output:crd:artifacts:config<span class="token operator">=</span>config/crd/bases
/root/MyOPeratorProjects/application-operator/bin/kustomize build config/crd <span class="token operator">|</span> kubectl apply <span class="token parameter variable">-f</span> -                                                     
customresourcedefinition.apiextensions.k8s.io/applications.apps.danielhu.cn created    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œå®Œmake installåï¼ŒCRDå°±éƒ¨ç½²åˆ°é›†ç¾¤ä¸­äº†ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡kubectlæŸ¥è¯¢åˆšæ‰åˆ›å»ºçš„CRDã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># kubectl get crd                        </span>
NAME                            CREATED AT                                 
applications.apps.danielhu.cn   <span class="token number">2023</span>-04-26T06:31:35Z      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œapplications.apps.danielhu.cnè¿™ä¸ªCRDå·²ç»å­˜åœ¨äº†ã€‚è¿™æ—¶å°±åƒæŸ¥è¯¢Deploymentæ—¶å¯ä»¥ç”¨kubectl get deploymentä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡kubectl get applicationæ¥æŸ¥è¯¢åˆšæ‰è‡ªå®šä¹‰çš„èµ„æºã€‚è¿™é‡Œçš„æŠ¥é”™ä¿¡æ¯æ˜¯æ²¡æ‰¾åˆ°èµ„æºï¼Œè€Œä¸æ˜¯â€œerror:the server doesnâ€™t have a resource type&quot;application&quot;â€ã€‚æ¢è¨€ä¹‹ï¼Œæ­¤æ—¶kube-apiserverå·²ç»èƒ½è¯†åˆ«è¿™ç§èµ„æºäº†ã€‚</p>
<p><strong>å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¾æ¬¡åšçš„äº‹æƒ…ï¼š</strong></p>
<ul>
<li>kubebuilder create api --group xxx --version v1 --king Application
<ul>
<li>è¿™æ—¶å€™åœ¨æç¤ºä¸‹åˆ›å»ºäº†èµ„æºå’Œcontroller</li>
<li>åˆ›å»ºäº†apiæ–‡ä»¶å¤¹ä»¥åŠå˜æ›´äº†main.goç­‰</li>
</ul>
</li>
<li>api/v1/application_types.goæ–‡ä»¶ä¸­importé‡ŒåŠ äº†corev1ï¼Œmetav1ï¼ŒApplicationSpectä¸­åŠ äº†replicaå’Œtemplateå£°æ˜å‰¯æœ¬çš„æ•°é‡å’Œæ¨¡æ¿çš„é…ç½®</li>
<li>make manifestså‘½ä»¤ç”ŸæˆCRï¼ˆconfig/rbac/role.yamlï¼ŒControlleréƒ¨ç½²åå°†å……å½“çš„â€œè§’è‰²â€ã€‚ï¼‰å’ŒCRDé…ç½®ï¼ˆconfig/crd/bases/apps.danielhu.cn_applications.yamlï¼‰ã€‚</li>
<li>é€šè¿‡make installå‘½ä»¤æ¥å®ŒæˆCRDçš„éƒ¨ç½²è¿‡ç¨‹ã€‚
<ul>
<li>å¯ä»¥getåˆ°crdäº†ï¼Œè¿™é‡Œcrdå°±åƒæ˜¯development</li>
</ul>
</li>
</ul>
<h3 id="5-CRéƒ¨ç½²">5. CRéƒ¨ç½²</h3>
<p>å’Œå†™ä¸€ä¸ªDeploymentèµ„æºé…ç½®å¯¹åº”çš„Ã—Ã—Ã—.yamlä¸€æ ·ï¼Œåˆ›å»ºApplicationåŒæ ·éœ€è¦ä¸€ä¸ªYAMLæ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨å‰é¢æåˆ°è¿‡åœ¨config/samplesä¸‹æœ‰ä¸€ä¸ªapps_v1_application.yamlï¼Œå…¶ä¸­å·²ç»æœ‰ä¸€äº›é»˜è®¤é…ç½®é¡¹äº†ï¼Œæˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ ä¸Šè‡ªå®šä¹‰çš„å±æ€§ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps.danielhu.cn/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Application
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> application<span class="token punctuation">-</span>sample
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token comment"># TODO(user): Add fields here</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>applyä¸€ä¸‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f config/samples/apps_v1</span>
application.apps.danielhu.cn/application-sample cr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æŸ¥çœ‹åˆšæ‰åˆ›å»ºçš„application</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># kubectl get application</span>
NAME                 AGE
application-sample   99s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä¸€ä¸ªApplicationç±»å‹çš„application-sampleå®ä¾‹åˆ›å»ºå‡ºæ¥äº†ï¼Œå…¶ä¸­åŒ…å«è‡ªå®šä¹‰çš„æ‰€æœ‰å­—æ®µã€‚ä½†æ˜¯è¿™æ—¶å¹¶ä¸ä¼šæœ‰Podè¢«è‡ªåŠ¨åˆ›å»ºå‡ºæ¥ï¼Œå› ä¸ºè¿˜æ²¡æœ‰å®ç°ç›¸åº”çš„æ§åˆ¶å™¨é€»è¾‘ã€‚</p>
<h3 id="6-Controllerå®ç°">6. Controllerå®ç°</h3>
<p>ç°åœ¨å·²ç»æœ‰äº†CRï¼Œè¯¥å®ç°Controlleré€»è¾‘å»åˆ›å»ºPodäº†ã€‚åœ¨controllers/application_controller.goä¸­çš„Reconcile()æ–¹æ³•å†…æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>ApplicationReconciler<span class="token punctuation">)</span> <span class="token function">Reconcile</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req ctrl<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	l <span class="token operator">:=</span> log<span class="token punctuation">.</span><span class="token function">FromContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>

	<span class="token comment">// get the Application</span>
	app <span class="token operator">:=</span> <span class="token operator">&amp;</span>dappsv1<span class="token punctuation">.</span>Application<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>NamespacedName<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">IsNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			l<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"the Application is not found"</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">&#125;</span>
		l<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"failed to get the Application"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">&#123;</span>RequeueAfter<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Minute<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> err
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// create pods</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">int</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Replicas<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		pod <span class="token operator">:=</span> <span class="token operator">&amp;</span>corev1<span class="token punctuation">.</span>Pod<span class="token punctuation">&#123;</span>
			ObjectMeta<span class="token punctuation">:</span> metav1<span class="token punctuation">.</span>ObjectMeta<span class="token punctuation">&#123;</span>
				Name<span class="token punctuation">:</span>      fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s-%d"</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
				Namespace<span class="token punctuation">:</span> app<span class="token punctuation">.</span>Namespace<span class="token punctuation">,</span>
				Labels<span class="token punctuation">:</span>    app<span class="token punctuation">.</span>Labels<span class="token punctuation">,</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
			Spec<span class="token punctuation">:</span> app<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Template<span class="token punctuation">.</span>Spec<span class="token punctuation">,</span>
		<span class="token punctuation">&#125;</span>

		<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> pod<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
			l<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"failed to create Pod"</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">&#123;</span>RequeueAfter<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Minute<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> err
		<span class="token punctuation">&#125;</span>
		l<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"the Pod (%s) has created"</span><span class="token punctuation">,</span> pod<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	l<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"all pods has created"</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>importéƒ¨åˆ†</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"time"</span>

	corev1 <span class="token string">"k8s.io/api/core/v1"</span>
	<span class="token string">"k8s.io/apimachinery/pkg/api/errors"</span>
	metav1 <span class="token string">"k8s.io/apimachinery/pkg/apis/meta/v1"</span>
	<span class="token string">"k8s.io/apimachinery/pkg/runtime"</span>
	ctrl <span class="token string">"sigs.k8s.io/controller-runtime"</span>
	<span class="token string">"sigs.k8s.io/controller-runtime/pkg/client"</span>
	<span class="token string">"sigs.k8s.io/controller-runtime/pkg/log"</span>
	
	dappsv1 <span class="token string">"github.com/daniel-hutao/application-operator/api/v1"</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™é‡Œæˆ‘ä»¬æŠŠè‡ªå·±çš„api/v1æ‰“åŒ…å¹¶ä½¿ç”¨åˆ«ådappsv1ï¼Œ<a target="_blank" rel="noopener" href="http://xn--k8s-9s1el2m457i.io/api/apps/v1%E5%8C%85%E4%BA%A7%E7%94%9F%E6%B7%B7%E6%B7%86%E3%80%82">é¿å…å’Œk8s.io/api/apps/v1åŒ…äº§ç”Ÿæ··æ·†ã€‚</a></p>
<p>ä»£ç è§£é‡Šï¼š</p>
<p><img src="/images/go_explain.png" alt="go_explain"></p>
<p>å¯åŠ¨controllerï¼šæ‰§è¡Œmake run</p>
<p><strong>æŠ¥é”™</strong></p>
<blockquote>
<p>æ­¤æ—¶ä¸å‡ºæ„å¤–çš„åˆå‡ºé—®é¢˜äº†ï¼Œè¾“å‡ºä¸€æ®µæ•°æ®åé¡µé¢åœæ­¢ä¸åŠ¨äº†ï¼Œè¿™æ—¶å€™ctrl+cé€€å‡ºï¼Œæ˜¾ç¤º</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>.682495037273707e+09   INFO    All workers finished    <span class="token punctuation">&#123;</span><span class="token string">"controller"</span><span class="token builtin class-name">:</span> <span class="token string">"application"</span>, <span class="token string">"controllerGroup"</span><span class="token builtin class-name">:</span> <span class="token string">"apps.danielhu.cn"</span>, <span class="token string">"controllerKind"</span><span class="token builtin class-name">:</span> <span class="token string">"Application"</span><span class="token punctuation">&#125;</span>
<span class="token number">1</span>.6824950372737312e+09  INFO    Stopping and waiting <span class="token keyword">for</span> caches
<span class="token number">1</span>.6824950372738228e+09  INFO    Stopping and waiting <span class="token keyword">for</span> webhooks
<span class="token number">1</span>.6824950372738297e+09  INFO    Wait completed, proceeding to <span class="token function">shutdown</span> the manager
make: *** <span class="token punctuation">[</span>run<span class="token punctuation">]</span> é”™è¯¯ <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸çŸ¥é“ä¸ºå•¥ï¼ŒæŸ¥çœ‹podä¿¡æ¯ï¼Œå‘ç°ä¸‰ä¸ªpodéƒ½åœ¨pending</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@master application-operator<span class="token punctuation">]</span><span class="token comment"># kubectl get pod</span>
NAME                   READY   STATUS    RESTARTS   AGE
application-sample-0   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          7m44s
application-sample-1   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          7m44s
application-sample-2   <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          7m44s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™æ—¶å€™è‚¯å®šæ˜¯describe podï¼Œè¾“å‡ºæœ€åçš„ä¿¡æ¯å¦‚ä¸‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Events:
  Type     Reason            Age                  From               Message
  ----     ------            ----                 ----               -------
  Warning  FailedScheduling  65s <span class="token punctuation">(</span>x6 over 8m33s<span class="token punctuation">)</span>  default-scheduler  <span class="token number">0</span>/3 nodes are available: <span class="token number">3</span> node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> had taints that the pod didn't tolerate.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´ä¸‰ä¸ªèŠ‚ç‚¹éƒ½æœ‰æ±¡ç‚¹ï¼Œmasterè‚¯å®šæ˜¯æœ‰æ±¡ç‚¹çš„ï¼Œå¦å¤–ä¸¤ä¸ªæ€ä¹ˆå›äº‹ï¼ŸæŸ¥çœ‹nodeï¼Œå‘ç°</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME     STATUS     ROLES    AGE     VERSION
master   Ready      master   5d16h   v1.17.4
node1    NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   5d15h   v1.17.4
node2    NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   5d15h   v1.17.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸¤ä¸ªèŠ‚ç‚¹ç«Ÿç„¶æ²¡è·‘èµ·æ¥ï¼Ÿdescribe node1å‘ç°æç¤ºNetworkUnavailable</p>
<p>ping Node1å‘ç°ä¸å¯è¾¾</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># ping node1</span>
PING node1 <span class="token punctuation">(</span><span class="token number">192.168</span>.62.134<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
From master <span class="token punctuation">(</span><span class="token number">192.168</span>.62.128<span class="token punctuation">)</span> <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">10</span> Destination Host Unreachable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä¸çŸ¥é“ä¸ºå•¥ç½‘æ–­äº†node1å¤±å»äº†ipåœ°å€ï¼Œæˆ‘è¿›å…¥node1é‡å¯ç½‘è·¯æœåŠ¡ï¼Œç½‘ç»œå¥½äº†ã€‚</p>
</blockquote>
<p><strong>æŠ¥é”™ï¼š</strong></p>
<blockquote>
<p>1.6824959595997632e+09  ERROR   setup   unable to start manager {â€œerrorâ€: â€œerror listening on :8080: listen tcp :8080: bind: address already in useâ€}</p>
<p>å› ä¸ºè¿™ä¸ªç«¯å£å·²ç»è¢«æˆ‘åˆ›å»ºå‡ºæ¥çš„podå äº†ï¼Œä¸ç”¨å†åˆ›å»ºæ–°çš„äº†ã€‚</p>
</blockquote>
<p>æ­¤æ—¶kubectl get podså¯ä»¥æŸ¥å‡ºä¸‰ä¸ªä¹‹å‰éƒ¨ç½²çš„podå·²ç»åœ¨è¿è¡Œäº†ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span>
NAME                   READY   STATUS    RESTARTS   AGE
application-sample-0   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          22h
application-sample-1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          22h
application-sample-2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          22h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="7-Controlleréƒ¨ç½²">7. Controlleréƒ¨ç½²</h3>
<p>å‰é¢æˆ‘ä»¬éƒ¨ç½²äº†ä¸€ä¸ªApplicationç±»å‹çš„èµ„æºå¯¹è±¡å®ä¾‹ï¼Œä¹Ÿè¿è¡ŒControllerçœ‹åˆ°äº†ç›¸åº”å‰¯æœ¬æ•°çš„Podè¢«åˆ›å»ºå‡ºæ¥ã€‚ç°åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥æ¨¡æ‹ŸOperatorå®é™…ä½¿ç”¨æ—¶çš„éƒ¨ç½²æ–¹å¼ï¼ŒæŠŠControlleræ‰“åŒ…åç”¨å®¹å™¨åŒ–æ–¹å¼éƒ¨ç½²åˆ°Kubernetesé›†ç¾¤ç¯å¢ƒä¸­ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> docker-build <span class="token assign-left variable">IMG</span><span class="token operator">=</span>application-operator:v0.0.1
kind load docker-image application-operator:v0.0.1 <span class="token parameter variable">--name</span> dev    no
<span class="token function">make</span> deploy <span class="token assign-left variable">IMG</span><span class="token operator">=</span>application-operator:v0.0.1 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å› ä¸ºæˆ‘çš„K8sä¸æ˜¯ä½¿ç”¨kindï¼Œæ‰€ä»¥çœæ‰äº†ç¬¬äºŒæ­¥ï¼Œæœ€ç»ˆæŸ¥åˆ°äº†éƒ¨ç½²çš„Pod</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@master application-operator<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n application-operator-system</span>
NAME                                                       READY   STATUS         RESTARTS   AGE
application-operator-controller-manager-5b754fc8bd-z28z9   <span class="token number">1</span>/2     ErrImagePull   <span class="token number">0</span>          2m46s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>è‡³æ­¤ï¼Œå°±å®ç°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„Operatorç¨‹åºçš„å¼€å‘ã€ç¼–è¯‘æ„å»ºã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰æµç¨‹ã€‚å½“ç„¶ï¼Œå¦‚æœå‰é¢æ‰§è¡Œmake runå¯åŠ¨äº†æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„3ä¸ªPodæ²¡æœ‰è¢«åˆ é™¤ï¼Œè¿™æ—¶å†æ¬¡éƒ¨ç½²ä¸€ä¸ªOperatoræ§åˆ¶å™¨ï¼Œæ—¥å¿—é‡Œè‚¯å®šä¼šæœ‰æŠ¥é”™ä¿¡æ¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®ç°Podå­˜åœ¨æ ¡éªŒç­‰ä»£ç é€»è¾‘ã€‚ä¸è¿‡è¿™ä¸æ˜¯é‡ç‚¹ï¼Œæœ‰æ²¡æœ‰è¿™äº›é”™è¯¯ï¼Œæˆ‘ä»¬çš„Demoç¨‹åºéƒ½ç®—èµ°å®Œäº†ã€‚åˆ°è¿™é‡Œï¼Œå¤§å®¶åŸºæœ¬ä½“éªŒäº†ä¸€éOperatorçš„å¿«é€Ÿå¼€å‘æµç¨‹ã€‚</p>
<h3 id="8-èµ„æºæ¸…ç†">8. èµ„æºæ¸…ç†</h3>
<p>å‰é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ªæ­¥éª¤åˆ†åˆ«éƒ¨ç½²äº†CRDã€CRå’ŒControllerï¼Œè¿™æ—¶ç¯å¢ƒä¸­æ–°å¢çš„èµ„æºä¸å°‘ï¼ˆå„ç§rbacç›¸å…³çš„ã€éƒ¨ç½²ç›¸å…³çš„èµ„æºï¼‰ï¼Œå¦‚æœè¿™äº›èµ„æºéƒ½ç”¨kubectlä¸€ä¸ªä¸€ä¸ªæ¥æ¸…ç†ï¼Œè¿˜æ˜¯å¾ˆç—›è‹¦çš„ã€‚åŒæ ·ï¼Œæ¸…ç†çš„æ­¥éª¤ä¹Ÿå¯ä»¥é€šè¿‡Makefileæ¥å®ç°ï¼š</p>
<p>å¸è½½Controllerï¼š<code>make undeploy</code></p>
<p>å¸è½½CRDï¼š<code>make uninstall</code></p>
<h3 id="9-æ€»ç»“ä¸ç†è§£">9.æ€»ç»“ä¸ç†è§£</h3>
<p><img src="/images/summarize_helloworld.png" alt=""></p>
<h3 id="10-å—é”¤æ„Ÿæ‚Ÿ">10. å—é”¤æ„Ÿæ‚Ÿ</h3>
<p>åœ¨åšçš„è¿‡ç¨‹ä¸­ä¸€æ¬¡æ¬¡çš„é‡åˆ°å„ç§é—®é¢˜ï¼Œç¯å¢ƒã€ç½‘ç»œã€ç‰ˆæœ¬åŒ¹é…ã€æ•²é”™å‘½ä»¤æ‰¾åŠå¤©ã€k8sè«åå‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€æ•™ç¨‹æœ‰è¯¯â€¦å„ç§é”™è¯¯ï¼Œæ— ä¸€ä¸è®©æˆ‘å¿ƒå¤´ç„¦ç¼æ”¥ç´§æ‹³å¤´ç«å†’ä¸‰ä¸ˆï¼Œå¿ƒç°æ„å†·ã€‚</p>
<p>ä¸æ–­é‡åˆ°é—®é¢˜ï¼Œä¸æ–­è§£å†³é—®é¢˜ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆç—›è‹¦ï¼Œä½†æ˜¯é—®é¢˜è§£å†³çš„é‚£ä¸€åˆ»å¾ˆæœ‰æˆå°±æ„Ÿã€‚</p>
<p>ç›¸ä¿¡åªè¦ä¸æ”¾å¼ƒï¼Œåœ¨è¢«å„ç§â€œé—®é¢˜â€æ´—ç¤¼çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„èƒ½åŠ›ä¼šè¶Šæ¥è¶Šå¼ºã€‚</p>
<blockquote>
<p>Notesï¼š</p>
<p>ä»¥ä¸Šå†…å®¹å‡ä¸ºä¸ªäººå­¦ä¹ è¿‡ç¨‹ä¸­çš„ç†è§£ï¼Œç†è§£å’Œæ€»ç»“å¯èƒ½æœ‰åå·®ã€‚æ–‡ç« å†…å®¹ä¼šéšç€å­¦ä¹ è¿‡ç¨‹ä¸æ–­ä¿®æ”¹å®Œå–„ã€‚</p>
<p>å¦‚æœä»¥ä¸Šæœ‰é”™è¯¯æ¬¢è¿æŒ‡å‡ºã€‚</p>
<p>æœ¬æ¬¡å®éªŒæ¡ˆä¾‹æ¥è‡ª èƒ¡æ¶› <a target="_blank" rel="noopener" href="https://www.danielhu.cn/categories/">https://www.danielhu.cn/categories/</a></p>
</blockquote>

</div>

<!-- post-guide -->

    <div class="post-guide">
        <div class="item left">
            
              <a href="/2023/04/26/7.%20%E3%80%90%E6%95%85%E9%9A%9C%E3%80%91K8s%E7%BB%84%E4%BB%B6%E7%89%88%E6%9C%AC%E5%87%BA%E9%97%AE%E9%A2%98/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  ã€æ•…éšœã€‘K8sç»„ä»¶ç‰ˆæœ¬å‡ºé—®é¢˜
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2023/04/25/5.%20%E4%BB%80%E4%B9%88%E6%98%AFOperator/">
                ä»€ä¹ˆæ˜¯Operator
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>


<!-- comment - giscus -->


<!-- comment - valine -->


<script>
	
	
</script>
	</div>
	<div id="footer">
	<p>
	Â©<span id="footerYear-start"></span>-<span id="footerYear-end"></span>
	<a href="/">å€ªå…‹æ¾</a> 
	
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>


<script type="text/javascript">
	document.getElementById('footerYear-start').innerHTML = new Date().getFullYear() + '';
</script>

<script type="text/javascript">
	document.getElementById('footerYear-end').innerHTML = new Date().getFullYear() + '';
</script>

	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>